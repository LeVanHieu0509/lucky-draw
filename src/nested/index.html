<pug src="./src/nested/index.pug"></pug>

<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Document</title>
    <link rel="stylesheet" href="./index.css" />
  </head>

  <body ng-app="app" ng-class="'theme-' + theme" class="ng-scope theme-purple">
    <div class="loader-block" id="loader" style="display: none"></div>
    <div class="wrapper" ng-style="{'background-image': url_background}">
      <!-- uiView: --><ui-view class="ng-scope"
        ><id-lucky-draw
          data="$ctrl.data"
          setting="$ctrl.setting"
          results="$ctrl.results"
          is-limited="$ctrl.isLimited(r)"
          class="ng-scope ng-isolate-scope"
          ><header class="header">
            <div class="container-fluid">
              <div class="row">
                <div class="logo-zone hidden">
                  <!-- ngIf: $ctrl.setting.info.logo -->
                </div>

                <div class="col-xs-12">
                  <h1>
                    <!-- ngIf: $ctrl.appState.name !== 'presentation' --><span
                      class="event-name ng-binding ng-scope"
                      ng-if="$ctrl.appState.name !== 'presentation'"
                    >
                    </span
                    ><!-- end ngIf: $ctrl.appState.name !== 'presentation' -->
                    <!-- ngIf: $ctrl.appState.name === 'presentation' && $ctrl.setting.info.name -->
                  </h1>
                </div>
              </div>
            </div>
          </header>

          <canvas id="confetti-canvas" class="confetti"></canvas>
          <div id="sunburst"></div>

          <div
            ng-class="$ctrl.appState.name === 'presentation' ? 'main-padding' : 'main'"
            class="main"
          >
            <div class="container-fluid">
              <div class="row">
                <div class="col-xs-12">
                  <section class="section section-prize">
                    <div class="section-message">
                      <h2
                        ng-style="$ctrl.ux.style($ctrl.setting.colors.action_msg, 1)"
                        ng-class="$ctrl.animClass.message"
                        ng-switch=""
                        on="$ctrl.state"
                        class="winner-reveal"
                        style=""
                      >
                        <!-- ngSwitchWhen: ready -->
                        <!-- ngSwitchWhen: spin -->
                        <!-- ngSwitchWhen: reveal -->
                        <!-- ngSwitchWhen: complete|toconfirm|confirmed|cancel --><span
                          ng-switch-when="complete|toconfirm|confirmed|cancel"
                          ng-switch-when-separator="|"
                          class="winner-name ng-binding ng-scope"
                          ng-bind-html="$ctrl.namex"
                          style=""
                        ></span
                        ><!-- end ngSwitchWhen: -->
                      </h2>
                    </div>

                    <div
                      class="section-body"
                      ng-class="$ctrl.animClass.setprize"
                      style=""
                    >
                      <div
                        class="section-body-inner section-body-inner-primary"
                      >
                        <ul class="slots">
                          <li
                            class="slot ng-scope slot-1of6 state-complete"
                            style="overflow: hidden"
                          >
                            <div
                              class="slotMachineContainer1"
                              style="
                                transition: 1.236s ease-out;
                                transform: matrix(1, 0, 0, 1, 0, 0);
                              "
                            >
                              <span
                                ng-class="$ctrl.state !== 'ready' ? 'not-available' : 'available'"
                                class="available"
                                style=""
                                ><img
                                  ng-src="/images/temp/bronze-prize.svg"
                                  src="../assets/images/bronze-prize.svg"
                              /></span>
                            </div>
                          </li>
                          <li
                            class="slot ng-scope slot-1of6 state-complete"
                            style="overflow: hidden"
                          >
                            <div
                              class="slotMachineContainer2"
                              style="
                                transition: 1.236s ease-out;
                                transform: matrix(1, 0, 0, 1, 0, 0);
                              "
                            >
                              <span
                                ng-class="$ctrl.state !== 'ready' ? 'not-available' : 'available'"
                                class="available"
                                style=""
                                ><img
                                  ng-src="/images/temp/bronze-prize.svg"
                                  src="../assets/images/bronze-prize.svg"
                              /></span>
                            </div>
                          </li>
                          <li
                            class="slot ng-scope slot-1of6 state-complete"
                            style="overflow: hidden"
                          >
                            <div
                              class="slotMachineContainer3"
                              style="
                                transition: 1.236s ease-out;
                                transform: matrix(1, 0, 0, 1, 0, 0);
                              "
                            >
                              <span
                                ng-class="$ctrl.state !== 'ready' ? 'not-available' : 'available'"
                                class="available"
                                style=""
                                ><img
                                  ng-src="/images/temp/bronze-prize.svg"
                                  src="../assets/images/bronze-prize.svg"
                              /></span>
                            </div>
                          </li>
                        </ul>
                      </div>
                    </div>

                    <div class="section-actions">
                      <div class="section-head-actions">
                        <a
                          class="link-prev not-available"
                          ng-mouseover="$ctrl.ux.mOver('prevnext')"
                          ng-mouseleave="$ctrl.ux.mLeave('prevnext')"
                          ng-class="$ctrl.state !== 'ready' || $ctrl.prizeIndex <= 0 ? 'not-available' : 'available'"
                          ng-click="$ctrl.setPrize($ctrl.prizeIndex - 1)"
                          style=""
                        >
                          <!-- ngIf: $ctrl.ux.hint.prevnext -->
                          <i class="ion-chevron-left"></i>
                        </a>

                        <div class="prize-text">
                          <input
                            class="input-min prize-count ion-person-add ng-binding"
                            value="001"
                          />

                          <input
                            class="input-max prize-count ion-person-add ng-binding"
                            value="999"
                          />
                        </div>

                        <a
                          class="link-next not-available"
                          ng-mouseover="$ctrl.ux.mOver('prevnext')"
                          ng-mouseleave="$ctrl.ux.mLeave('prevnext')"
                          ng-class="$ctrl.state !== 'ready' || $ctrl.prizeIndex >= $ctrl.prizes.length - 1 ? 'not-available' : 'available'"
                          ng-click="$ctrl.setPrize($ctrl.prizeIndex + 1)"
                          style=""
                        >
                          <i class="ion-chevron-right"></i>
                          <!-- ngIf: $ctrl.ux.hint.prevnext -->
                        </a>
                      </div>

                      <div ng-switch="" on="$ctrl.state" class="section-button">
                        <div
                          ng-switch-when="complete"
                          class="state-complete ng-scope"
                          style=""
                        >
                          <a
                            class="btn btn-yellow btn-yellow-secondary ng-binding"
                            ng-click="$ctrl.save()"
                            ng-mouseover="$ctrl.ux.mOver('confirm')"
                            ng-mouseleave="$ctrl.ux.mLeave('confirm')"
                          >
                            <!-- ngIf: $ctrl.ux.hint.confirm -->
                            Quay số
                          </a>
                          <a
                            class="btn btn-primary ng-binding"
                            ng-click="$ctrl.retry()"
                            ng-mouseover="$ctrl.ux.mOver('confirm')"
                            ng-mouseleave="$ctrl.ux.mLeave('confirm')"
                          >
                            Dừng lại
                            <!-- ngIf: $ctrl.ux.hint.confirm -->
                          </a>
                        </div>
                        <!-- end ngSwitchWhen: -->
                      </div>
                    </div>
                  </section>
                </div>
              </div>
            </div>
          </div>

          <hot-keys
            enter="$ctrl.startstop()"
            nextstep=""
            confirm="$ctrl.save()"
            cancel="$ctrl.retry()"
            prev="$ctrl.setPrevPrize()"
            next="$ctrl.setNextPrize()"
            class="ng-isolate-scope"
          >
          </hot-keys>
        </id-lucky-draw>
      </ui-view>
      <notification class="ng-isolate-scope"></notification>
      <img width="1" height="1" appbackground="" ng-src="" />
    </div>

    <script>
      // document.addEventListener("DOMContentLoaded", () => {
      //   const slots = document.querySelectorAll(".slotMachineContainer");
      //   const spinButton = document.querySelector(".btn-yellow");
      //   const spinReset = document.querySelector(".btn-primary");

      //   const max = 999; // Maximum value for random number
      //   const min = 100; // Minimum value
      //   const num_icons = 10; // Number of icons (0-9)
      //   const icon_height = 250; // Height of each icon
      //   const max_translate_y = 2000; // Limit for translateY value
      //   const time_per_icon = 100; // Animation duration per icon
      //   let listWinnerNum = []; // List of used numbers

      //   // Generate unique random winner
      //   function randomWinner() {
      //     let randNum = Math.floor(Math.random() * (max - min + 1) + min);
      //     while (listWinnerNum.includes(randNum)) {
      //       randNum = Math.floor(Math.random() * (max - min + 1) + min);
      //     }
      //     listWinnerNum.push(randNum);
      //     if (listWinnerNum.length >= max - min + 1) listWinnerNum = [];
      //     return randNum;
      //   }

      //   // Reset slots to the initial state
      //   function resetSlots() {
      //     slots.forEach((slot) => {
      //       slot.style.transition = "none";
      //       slot.style.transform = "translateY(0px)";
      //     });
      //   }

      //   // Spin a single slot
      //   function roll(slot, offset, winner_num) {
      //     const delta =
      //       (offset + 2) * num_icons + (num_icons - +winner_num + 1);

      //     const spin_distance = delta * icon_height;
      //     const targetPositionY =
      //       spin_distance > max_translate_y
      //         ? spin_distance % max_translate_y
      //         : spin_distance;

      //     return new Promise((resolve) => {
      //       // Get the current Y position
      //       const style = getComputedStyle(slot);
      //       const transformMatrix = style.transform.match(/matrix.*\((.+)\)/);
      //       const currentPositionY = transformMatrix
      //         ? parseFloat(transformMatrix[1].split(",")[5])
      //         : 250; // Default to 250px for first spin

      //       if (spin_distance > max_translate_y) {
      //         // Exceeds max_translate_y, reset and animate
      //         setTimeout(() => {
      //           slot.style.transition = "none";
      //           slot.style.transform = `translateY(${currentPositionY % max_translate_y}px)`;

      //           setTimeout(() => {
      //             slot.style.transition = `transform ${(9 + delta) * time_per_icon}ms cubic-bezier(.41,-0.01,.63,1.09)`;
      //             slot.style.transform = `translateY(-${targetPositionY}px)`;
      //           }, 50);
      //         }, offset * 150);
      //       } else {
      //         // Normal animation within range
      //         setTimeout(() => {
      //           slot.style.transition = `transform ${(9 + delta) * time_per_icon}ms cubic-bezier(.41,-0.01,.63,1.09)`;
      //           slot.style.transform = `translateY(-${targetPositionY}px)`;
      //         }, offset * 150);
      //       }

      //       // Stop at the final normalized position
      //       setTimeout(
      //         () => {
      //           slot.style.transition = "none";
      //           slot.style.transform = `translateY(-${targetPositionY % max_translate_y}px)`;
      //           resolve(delta % num_icons);
      //         },
      //         (9 + delta) * time_per_icon + offset * 150,
      //       );
      //     });
      //   }

      //   // Spin all slots
      //   function rollAll() {
      //     // resetSlots();
      //     const reelsList = document.querySelectorAll(".slotMachineContainer");
      //     const randomNumber = randomWinner();
      //     const winnerNumArray = String(randomNumber)
      //       .padStart(3, "0")
      //       .split("");
      //     console.log("Winning Number:", randomNumber, winnerNumArray);

      //     Promise.all(
      //       [...reelsList].map((slot, index) =>
      //         roll(slot, index, winnerNumArray[index]),
      //       ),
      //     ).then(() => {
      //       document.querySelector(".slots")?.classList?.add("win1");
      //       setTimeout(() => {
      //         document.querySelector(".slots")?.classList?.remove("win1");
      //       }, 2000);
      //     });
      //   }

      //   // Disable button during spin
      //   function disableButton() {
      //     spinButton.disabled = true;
      //     setTimeout(() => {
      //       spinButton.disabled = false;
      //     }, 5000); // Adjust as needed
      //   }

      //   if (spinButton) {
      //     spinButton.addEventListener("click", () => {
      //       disableButton();
      //       rollAll();
      //     });
      //   } else {
      //     console.error("Spin button not found!");
      //   }

      //   if (spinReset) {
      //     spinReset.addEventListener("click", () => {
      //       resetSlots();
      //     });
      //   } else {
      //     console.error("Spin button not found!");
      //   }
      // });

      // Promise.all(
      //   [1, 2, 3].map((slot, index) =>
      //     roll(slot, index, winnerNumArray[index]),
      //   ),
      // ).then(() => {
      //   document.querySelector(".slots")?.classList?.add("win1");
      //   setTimeout(() => {
      //     document.querySelector(".slots")?.classList?.remove("win1");
      //   }, 2000);
      // });
    </script>

    <script type="module" src="./index.ts"></script>
  </body>
</html>
